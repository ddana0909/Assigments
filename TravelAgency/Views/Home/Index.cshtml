@model IEnumerable<TravelAgency.Models.Trip>

@{
    ViewBag.Title = "Index";
}

@section scripts
{
    <script type="text/javascript">

        $(function () {
            $("[data-toggle='tooltip']").tooltip();
        });
        
        function getTimeLine(id) {
            $.ajax({
                url: '@Url.Action("GetProgressBar")',
                data: { tripId: id },
                success: function (data) {
                    $('#timeline_' + id).html(data);
                    $("[data-toggle='tooltip']").tooltip();
                }
            });
        }

        function getTripDetails(tripId) {
            getTimeLine(tripId);
            $.ajax({
                url: "api/LegApi/" + tripId,
                type: "Get",
                success: function (data) {
                    $('#m_' + tripId).empty();

                    $("<div id='guestsModal' class='modal fade' role='dialog' aria-hidden='true'><br /><br />" +
                        "<br /> <div class='col-md-offset-4 col-md-4' id='guestsDetails'></div></div>").appendTo('#m_' + tripId);

                    for (var i = 0; i < data.length; i++) {
                        $("<div class='row' id='" + data[i].Id + "'>" +
                             "<div class='col-md-2 text-right' >" +
                                   "<div class='btn btn-info btn-xs'>" + (i + 1) + "</div>" +
                            "</div>" +
                            "<div class='col-md-9'>" +
                            "<strong>" + data[i].StartLocation + " - " + data[i].FinishLocation + " </strong>" +
                             new Date(data[i].StartDate).toLocaleDateString()+ "-" +
                             new Date(data[i].FinishDate).toLocaleDateString() +
                            "</div>" +
                            "<div class='col-md-1'>" +
                                "<span class='badge' onclick='showGuests(" + data[i].Id + ")' style='cursor: pointer'>" +
                                    data[i].x + " Guests" +
                                 "</span>" +
                            "</div>" +
                        "</div>" +
                        "<br/>"
                            ).appendTo('#m_' + tripId);

                    }
                }
            });

        }
        
        function showGuests(id) {
            $.ajax({
                url: '@Url.Action("GetGuestsOnLeg")',
                data: { legId: id },
                success: function (data) {
                    $('#guestsModal').modal("show");
                    $("#guestsDetails").html(data).modal("show");
                }
            });
        }

    </script>
}

<h2>Trips</h2>

<p>
    @Html.ActionLink("Add New Trip", "Create")
</p>


<div id="guestsModal" class="modal fade" role="dialog" aria-hidden="true">
    <br />
    <br />
    <br />
    <div class="col-md-offset-4 col-md-4" id="guestsDetails">
    </div>
</div>


@foreach (var item in Model)
{
    <div class="row" id="@item.Id" onclick=" getTripDetails(@item.Id)">
        <div class="col-md-4">
            <br />

            <img src="@Url.Content(item.PicturePath)" alt="Album Picture" />
        </div>
        <div class="col-md-3">
            <div class="row text-center">
                <h2>@Html.DisplayFor(modelItem => item.Name)</h2>
            </div>
            <div class="row text-center">
                <h4>@Html.DisplayFor(modelItem => item.StartDate) -
                    @Html.DisplayFor(modelItem => item.FinishDate)</h4>
            </div>
            <div class="row text-center">
                <span class="badge">Min @item.MinimumGuests Guests</span>
            </div>
            <br />
            <div class="row">
                <div class="col-md-offset-2 col-md-4 text-center">
                    <div class=" row">
                        @Html.DisplayNameFor(model => model.Viable)
                    </div>
                    <div class="row">
                        @if (@item.Viable)
                        {
                            <button
                                class="btn-default btn-sm btn-success"
                                data-toggle="tooltip"
                                data-placement="bottom"
                                title=""
                                data-original-title="Minimum number of Guest is reached">
                                <span class="glyphicon glyphicon-ok"></span>
                            </button> 
                                               
                        }

                        @if (@item.Viable == false)
                        {
                            <button
                                class="btn-default btn-sm btn-danger"
                                data-toggle="tooltip"
                                data-placement="bottom"
                                title=""
                                data-original-title="The minimum number of guests is not reached yet">
                                <span class="glyphicon glyphicon-remove"></span>
                            </button> 
                        }

                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div class="row">
                        @Html.DisplayNameFor(model => model.Complete)
                    </div>
                    <div class="row">
                        @if (@item.Complete)
                        {
                            <button
                                class="btn-default btn-sm btn-success"
                                data-toggle="tooltip"
                                data-placement="bottom"
                                title=""
                                data-original-title="Legs are planned for each day of the trip">
                                <span class="glyphicon glyphicon-ok"></span>
                            </button> 
                        }
                        @if (@item.Complete == false)
                        {
                            <button
                                class="btn-default btn-sm btn-danger"
                                data-toggle="tooltip"
                                data-placement="bottom"
                                title=""
                                data-original-title="Legs still missing">
                                <span class="glyphicon glyphicon-remove"></span>
                            </button>
                        }
                    </div>
                </div>

            </div>

        </div>
        <div class="col-md-5" id="m_@item.Id"></div>
    </div>
    <div class="row">
        <div class="col-md-7" id="timeline_@item.Id">
        </div>
    </div>
    <br />
    <br />
}




